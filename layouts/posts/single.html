{{ define "main" }}

{{/* SEU BLOCO DE TESTE PARA CUSTOM CSS (MANTIDO COMO VOCÊ TINHA) */}}
{{ $customCSS := resources.Get "css/custom.css" }}
{{ if $customCSS }}
    {{ if eq hugo.Environment "production" }}
        {{ $customCSS = $customCSS | fingerprint | resources.PostProcess }}
    {{ end }}
    <link rel="stylesheet" href="{{ $customCSS.RelPermalink }}" {{ if eq hugo.Environment "production" }}integrity="{{ $customCSS.Data.Integrity }}"{{ end }}>
    {{ `` | safeHTML }}
{{ else }}
    {{ warnf "DEBUG SINGLE.HTML: custom.css NÃO ENCONTRADO!" }}
    {{ `` | safeHTML }}
{{ end }}
{{/* FIM DO BLOCO DE TESTE DO CUSTOM CSS */}}

<article class="py-8">
    {{/* --- SEÇÃO DA IMAGEM DE DESTAQUE (BANNER) --- */}}
    {{ with .Params.images }}
        {{ range first 1 . }} {{/* Pega a primeira imagem da lista */}}
            {{ $imagePath := . }}
            {{ $imageResource := "" }}
            {{ $isStaticImage := false }}

            {{/* Tenta primeiro como um recurso de assets (global ou da página) */}}
            {{ if strings.HasPrefix . "/" }}
                {{ $assetPath := strings.TrimPrefix "/" . }}
                {{ if resources.Get $assetPath }}
                    {{ $imageResource = resources.Get $assetPath }}
                {{ else if fileExists (printf "static/%s" $assetPath) }}
                    {{ $isStaticImage = true }}
                {{ end }}
            {{ else }}
                {{ $imageResource = $.Resources.GetMatch . }}
            {{ end }}

            {{/* Container para a imagem de destaque, para controlar o max-width se necessário */}}
            {{/* A classe max-w-4xl aqui tenta alinhar a largura da imagem com a do conteúdo abaixo se seu conteúdo tiver um container similar.
                 Seu 'prose' tem max-w-2xl, então você pode preferir max-w-2xl ou max-w-3xl para a imagem.
                 Ajuste conforme o design desejado. */}}
            <div class="max-w-4xl mx-auto mb-6 px-4"> 
                {{ if $imageResource }}
                    {{/* ---- AJUSTE AS DIMENSÕES DE PROCESSAMENTO AQUI ---- */}}
                    {{/* LARGURA x ALTURA. Ex: 800px de largura e 200px de altura para um banner */}}
                    {{/* "smart" tenta encontrar o ponto focal. "Center" também é uma opção. */}}
                    {{ $processedImage := $imageResource.Fill "800x200 smart" }} 
                    <img src="{{ $processedImage.RelPermalink }}" 
                         width="{{ $processedImage.Width }}" 
                         height="{{ $processedImage.Height }}" 
                         alt="{{ $.Title }} - Imagem de Destaque" 
                         class="w-full rounded-lg shadow-lg object-cover" 
                         style="max-height: 250px;"> {{/* max-height opcional via CSS para controle extra */}}
                {{ else if $isStaticImage }}
                    <img src="{{ $imagePath | relURL }}" 
                         alt="{{ $.Title }} - Imagem de Destaque" 
                         class="w-full rounded-lg shadow-lg object-cover" 
                         style="height: 200px; max-height: 250px;"> {{/* Para imagens estáticas, controle altura com CSS */}}
                {{ else }}
                    {{ warnf "Imagem de destaque '%s' definida em .Params.images não encontrada." $imagePath }}
                {{ end }}
            </div>
        {{ end }}
    {{ end }}
    {{/* --- FIM DA SEÇÃO DA IMAGEM DE DESTAQUE --- */}}


    <header class="mb-8">
        <div class="container mx-auto px-4 text-center"> {{-- Centraliza título e metadados --}}
            
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight text-gray-900 dark:text-white mb-4">
                {{ .Title }}
            </h1>
            
            {{ with .Params.subtitle }}
                <p class="text-xl text-gray-600 dark:text-gray-400 mb-6">{{ . }}</p>
            {{ end }}

            <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                <span>Publicado em {{ .Date.Format (.Site.Params.DateFormat | default "2 de Janeiro de 2006") }}</span>
                {{ if .Site.Params.ShowReadingTime }}
                    <span class="mx-1">&middot;</span>
                    <span>{{ .ReadingTime }} min de leitura</span>
                {{ end }}
                {{ with .Params.author }}
                    <span class="mx-1">&middot;</span>
                    <span>Por {{ . }}</span>
                {{ end }}
            </div>

            {{ with .Params.tags }}
            <div class="mb-4">
                {{ range . }}
                    <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="inline-block bg-gray-200 dark:bg-gray-700 rounded-full px-3 py-1 text-xs font-semibold text-gray-700 dark:text-gray-200 mr-2 mb-2 hover:bg-primary-500 dark:hover:bg-primary-400 hover:text-white dark:hover:text-black transition-colors duration-150">#{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </header>

    {{/* Conteúdo Principal do Post (Markdown) */}}
    <div class="max-w-2xl px-6 pt-6 pb-16 mx-auto prose dark:prose-invert dark:text-white">
        {{ .Content }}
    </div>

    {{/* Seção de Comentários */}}
    <div class="max-w-2xl px-6 pb-16 mx-auto comments-container">
        {{- partial "comments.html" . -}}
    </div>
</article>

{{ end }}