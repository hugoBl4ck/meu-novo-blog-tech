{{- /* layouts/partials/comments.html - Versão Final Funcional */ -}}

{{- $showCommentsForPage := false -}}{{/* Inicializa a variável de controle */}}

{{- /* Verifica se o tipo da página atual está entre os tipos onde os comentários são permitidos */}}
{{- $isAllowedType := false -}}
{{- if .Site.Params.mainSections -}}
  {{- if in .Site.Params.mainSections .Type -}}
    {{- $isAllowedType = true -}}
  {{- end -}}
{{- end -}}
{{- $isAllowedType = or $isAllowedType (eq .Type "posts") (eq .Type "blog") -}}

{{- /* Condição final para mostrar comentários */}}
{{- if and .Site.Params.comments $isAllowedType (ne .Params.comments false) -}}
  {{- $showCommentsForPage = true -}}
{{- end -}}


{{- if $showCommentsForPage -}}
    {{- /* Verifica se a configuração do repositório Giscus existe no hugo.toml */}}
    {{- if .Site.Params.giscus.repo -}}
        <div class="comments giscus" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <h3>{{ .Site.Params.giscus.title | default "Comentários" }}</h3>
            <script src="https://giscus.app/client.js"
                    data-repo="{{ .Site.Params.giscus.repo }}"
                    data-repo-id="{{ .Site.Params.giscus.repoId }}"
                    data-category="{{ .Site.Params.giscus.category }}"
                    data-category-id="{{ .Site.Params.giscus.categoryId }}"
                    data-mapping="{{ .Site.Params.giscus.mapping | default "pathname" }}"
                    data-strict="{{ .Site.Params.giscus.strict | default "0" }}"
                    data-reactions-enabled="{{ .Site.Params.giscus.reactionsEnabled | default "1" }}"
                    data-emit-metadata="{{ .Site.Params.giscus.emitMetadata | default "0" }}"
                    data-input-position="{{ .Site.Params.giscus.inputPosition | default "bottom" }}"
                    data-theme="{{ .Site.Params.giscus.theme | default "preferred_color_scheme" }}"
                    data-lang="{{ .Site.Params.giscus.lang | default "pt" }}"
                    data-loading="{{ .Site.Params.giscus.loading | default "lazy" }}"
                    crossorigin="anonymous"
                    async>
            </script>
            <noscript>Por favor, habilite o JavaScript para ver os <a href="https://giscus.app">comentários do Giscus.</a></noscript>
            <p style="font-size: 0.9rem; margin-top: 1rem;">
                <a href="https://github.com/{{ .Site.Params.giscus.repo }}/discussions" target="_blank" rel="noopener noreferrer">
                    Ver discussões no GitHub
                </a>
            </p>
        </div>
    {{- else -}}
        {{- /* Mensagem para o autor do site se giscus.repo não estiver configurado */}}
        <p style="color: orange; font-style: italic;">Configuração de comentários (Giscus repo) ausente.</p>
    {{- end -}}
{{- else -}}
    {{- /* Comentário HTML opcional para indicar que os comentários foram intencionalmente omitidos por esta página
         Isso não aparecerá para os visitantes, apenas no código-fonte.
         Pode ser útil para você no futuro se perguntar por que os comentários não estão em uma página específica.
    */}}
    {{- end -}}